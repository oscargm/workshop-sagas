<!DOCTYPE html>
<!-- saved from url=(0042)http://workshop-sagas.limenius.com/effects -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Gatsby 2.15.18"><title data-react-helmet="true"></title><link rel="manifest" href="http://workshop-sagas.limenius.com/manifest.webmanifest"><meta name="theme-color" content="#663399"><link rel="apple-touch-icon" sizes="48x48" href="http://workshop-sagas.limenius.com/icons/icon-48x48.png"><link rel="apple-touch-icon" sizes="72x72" href="http://workshop-sagas.limenius.com/icons/icon-72x72.png"><link rel="apple-touch-icon" sizes="96x96" href="http://workshop-sagas.limenius.com/icons/icon-96x96.png"><link rel="apple-touch-icon" sizes="144x144" href="http://workshop-sagas.limenius.com/icons/icon-144x144.png"><link rel="apple-touch-icon" sizes="192x192" href="http://workshop-sagas.limenius.com/icons/icon-192x192.png"><link rel="apple-touch-icon" sizes="256x256" href="http://workshop-sagas.limenius.com/icons/icon-256x256.png"><link rel="apple-touch-icon" sizes="384x384" href="http://workshop-sagas.limenius.com/icons/icon-384x384.png"><link rel="apple-touch-icon" sizes="512x512" href="http://workshop-sagas.limenius.com/icons/icon-512x512.png"><link as="script" rel="preload" href="./effects_files/app-ee930383911b7a727950.js.descarga"><link as="script" rel="preload" href="./effects_files/component---src-pages-index-js-b322a44ac5e914e16600.js.descarga"><link as="script" rel="preload" href="./effects_files/commons-6653d574c9f9e480a8c9.js.descarga"><link as="script" rel="preload" href="./effects_files/webpack-runtime-5138ec910dab2fc8c32f.js.descarga"><link as="fetch" rel="preload" href="http://workshop-sagas.limenius.com/page-data/index/page-data.json" crossorigin="anonymous"><style data-emotion-css="hz92mv">.css-hz92mv{box-sizing:border-box;margin:0;min-width:0;font-size:24px;font-family:system-ui,sans-serif;font-weight:700;line-height:1.25;font-size:64px;}</style><style data-emotion-css="oio2uc">.css-oio2uc{box-sizing:border-box;margin:0;min-width:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:inline-block;text-align:center;line-height:inherit;-webkit-text-decoration:none;text-decoration:none;font-size:inherit;padding-left:16px;padding-right:16px;padding-top:8px;padding-bottom:8px;color:white;background-color:var(--theme-ui-colors-primary,#07c);border:0;border-radius:4px;font-size:16px;font-weight:700;color:var(--theme-ui-colors-background,#fff);background-color:var(--theme-ui-colors-primary,#07c);border-radius:4px;margin-right:4px;}</style><style data-emotion-css="vbif7y">.css-vbif7y{box-sizing:border-box;margin:0;min-width:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:inline-block;text-align:center;line-height:inherit;-webkit-text-decoration:none;text-decoration:none;font-size:inherit;padding-left:16px;padding-right:16px;padding-top:8px;padding-bottom:8px;color:white;background-color:var(--theme-ui-colors-primary,#07c);border:0;border-radius:4px;font-size:16px;font-weight:700;color:var(--theme-ui-colors-primary,#07c);background-color:transparent;border-radius:4px;box-shadow:inset 0 0 2px;margin-right:4px;}</style><style data-emotion-css="vbif7y">.css-vbif7y{box-sizing:border-box;margin:0;min-width:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:inline-block;text-align:center;line-height:inherit;-webkit-text-decoration:none;text-decoration:none;font-size:inherit;padding-left:16px;padding-right:16px;padding-top:8px;padding-bottom:8px;color:white;background-color:var(--theme-ui-colors-primary,#07c);border:0;border-radius:4px;font-size:16px;font-weight:700;color:var(--theme-ui-colors-primary,#07c);background-color:transparent;border-radius:4px;box-shadow:inset 0 0 2px;margin-right:4px;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="1s6s98">.css-1s6s98{box-sizing:border-box;margin:0;min-width:0;font-size:24px;font-family:system-ui,sans-serif;font-weight:700;line-height:1.25;font-size:32px;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="162xvp5">.css-162xvp5{box-sizing:border-box;margin:0;min-width:0;font-size:24px;font-family:system-ui,sans-serif;font-weight:700;line-height:1.25;font-size:20px;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="162xvp5">.css-162xvp5{box-sizing:border-box;margin:0;min-width:0;font-size:24px;font-family:system-ui,sans-serif;font-weight:700;line-height:1.25;font-size:20px;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="162xvp5">.css-162xvp5{box-sizing:border-box;margin:0;min-width:0;font-size:24px;font-family:system-ui,sans-serif;font-weight:700;line-height:1.25;font-size:20px;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="162xvp5">.css-162xvp5{box-sizing:border-box;margin:0;min-width:0;font-size:24px;font-family:system-ui,sans-serif;font-weight:700;line-height:1.25;font-size:20px;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="vbif7y">.css-vbif7y{box-sizing:border-box;margin:0;min-width:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:inline-block;text-align:center;line-height:inherit;-webkit-text-decoration:none;text-decoration:none;font-size:inherit;padding-left:16px;padding-right:16px;padding-top:8px;padding-bottom:8px;color:white;background-color:var(--theme-ui-colors-primary,#07c);border:0;border-radius:4px;font-size:16px;font-weight:700;color:var(--theme-ui-colors-primary,#07c);background-color:transparent;border-radius:4px;box-shadow:inset 0 0 2px;margin-right:4px;}</style><style data-styled="" data-styled-version="4.3.2"></style><link rel="prefetch" href="http://workshop-sagas.limenius.com/page-data/effects/page-data.json"><link rel="prefetch" href="http://workshop-sagas.limenius.com/page-data/testing/page-data.json"><link rel="prefetch" href="./effects_files/component---src-pages-effects-js-67bf1d53312ef66d9094.js.descarga"><link rel="prefetch" href="./effects_files/component---src-pages-testing-js-30c8d936f19f61056628.js.descarga"><script charset="utf-8" src="./effects_files/component---src-pages-effects-js-67bf1d53312ef66d9094.js.descarga"></script><script charset="utf-8" src="./effects_files/component---src-pages-testing-js-30c8d936f19f61056628.js.descarga"></script><style data-emotion="css"></style></head><body class=""><script>(function() { try {
        var mode = localStorage.getItem('theme-ui-color-mode');
        if (!mode) return
        document.body.classList.add('theme-ui-' + mode);
      } catch (e) {} })();</script><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div><div><h2 class="Heading__PdHeading-sc-1rvjej-0 jhtTmC css-hz92mv">Sagas Workshop</h2><button class="css-vbif7y"><a class="ButtonLink__StyledLink-sc-1vwfx20-0 fbWjxs" href="http://workshop-sagas.limenius.com/">Generators</a></button><button class="css-oio2uc"><a aria-current="page" class="Toc__StyledLinkActive-qwmjyy-0 kDDVDJ" href="http://workshop-sagas.limenius.com/effects">Effects</a></button><button class="css-vbif7y"><a class="ButtonLink__StyledLink-sc-1vwfx20-0 fbWjxs" href="http://workshop-sagas.limenius.com/testing">Testing</a></button></div><h2 class="Heading__PdHeading-sc-1rvjej-0 iWbnHQ css-1s6s98">Effects</h2><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Setup</h2><div class="css-h14gkn">Clone the repo in <a href="https://github.com/Limenius/workshop-sagas" class="css-1pjpbx4">https://github.com/Limenius/workshop-sagas</a> with:</div><div class="Command__PBorder-j2el8m-0 gvcvRb"><div class="css-h14gkn"><code>git clone https://github.com/Limenius/workshop-sagas.git</code></div></div><div class="css-h14gkn">and run:</div><div class="Command__PBorder-j2el8m-0 gvcvRb"><div class="css-h14gkn"><code>yarn install</code></div></div><div class="Command__PBorder-j2el8m-0 gvcvRb"><div class="css-h14gkn"><code>yarn start</code></div></div><div class="css-h14gkn">You should see three button (only one does something at this point)</div><div class="css-h14gkn">If we look into <code>src/makeStore.js</code> you should see this code:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span><span class="react-syntax-highlighter-line-number">11
</span><span class="react-syntax-highlighter-line-number">12
</span><span class="react-syntax-highlighter-line-number">13
</span><span class="react-syntax-highlighter-line-number">14
</span><span class="react-syntax-highlighter-line-number">15
</span><span class="react-syntax-highlighter-line-number">16
</span><span class="react-syntax-highlighter-line-number">17
</span><span class="react-syntax-highlighter-line-number">18
</span><span class="react-syntax-highlighter-line-number">19
</span><span class="react-syntax-highlighter-line-number">20
</span><span class="react-syntax-highlighter-line-number">21
</span></code><code><span style="color: rgb(133, 153, 0);">import</span> { compose, applyMiddleware, createStore } <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"redux"</span>;
<span style="color: rgb(133, 153, 0);">import</span> createSagaMiddleware <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"redux-saga"</span>;

<span style="color: rgb(133, 153, 0);">import</span> { rootSaga } <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"./sagas"</span>;
<span style="color: rgb(133, 153, 0);">import</span> reducer <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"./reducers"</span>;

<span style="color: rgb(133, 153, 0);">export</span> <span style="color: rgb(133, 153, 0);">const</span> makeStore = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span style="color: rgb(133, 153, 0);">const</span> composeEnhancers =
    global.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;

  <span style="color: rgb(133, 153, 0);">const</span> sagaMiddleware = createSagaMiddleware();

  <span style="color: rgb(133, 153, 0);">const</span> store = createStore(
    reducer,
    composeEnhancers(applyMiddleware(sagaMiddleware))
  );

  sagaMiddleware.run(rootSaga);

  <span style="color: rgb(133, 153, 0);">return</span> store;
};
</code></pre><div class="css-h14gkn">This is the basic setup of redux-saga, we define a "root saga", which will be our entry point. This root saga looks like this:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span></code><code><span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(220, 50, 47);">console</span>.log(<span style="color: rgb(42, 161, 152);">"hi from sagas"</span>);
}</code></pre><div class="css-h14gkn">And, if we have a look into the console, we will see that the saga is executing. Although it is not doing much. It is a start, though.</div><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Structure of this playground</h2><div class="css-h14gkn">Let's examine the reducer and the idea behind this playground project</div><div class="css-h14gkn">We have a reducer <code>src/reducrs/tasks</code>, that holds an array of tasks.</div><div class="css-h14gkn">Tasks have this structure: <code>{name, status}</code>. A name, that will be randomly generated and will be a unique identifier. And a status, which describes the situation of the task.</div><div class="css-h14gkn">The possible 4 available status are <code>IDLE</code>, <code>STARTED</code>, <code>DONE</code> and <code>FAILED</code>.</div><div class="css-h14gkn">We have some action types in <code>src/actions/constants</code>.</div><div class="css-h14gkn"><code>TASK_CREATE</code>: creates a task, if we press the button "Create a task!" and we inspect it in the Redux debugger we will see how it is dispatched. This task is handled by the reducer directly and we don't need to react upon it, but it has the same structure as other important tasks: It takes the name of the task as a parameter.</div><div class="css-h14gkn">Then we have a typical structure of 4 actions to process a request with Redux Saga.</div><ul><li><code>TASK_PROCESS</code>: <div class="css-h14gkn">This will be handled by sagas as a signal to start processing the task with the provided name.</div></li><li><code>TASK_PROCESS_START</code>: <div class="css-h14gkn">The saga will dispatch this action before start processing the task with the provided name. The reducer will update the task, and visually this allows us to show a spinner.</div></li><li><code>TASK_PROCESS_DONE</code>: <div class="css-h14gkn">If the task is fullfilled, sagas will dispatch this action to mark its completion. The reducer will process it to update the task.</div></li><li><code>TASK_PROCESS_RESET</code>: <div class="css-h14gkn">If the task fails, sagas will dispatch this action to signify that an error has ocurred. The reducer will process it to update the task.</div></li></ul><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Basic effects</h2><div class="css-h14gkn">Let's play with our sagas!</div><div class="css-h14gkn">We have our generator rootSaga in <code>src/rootSaga.js</code>. It is a <code>function*</code> so, a generator, but it is not <code>yield</code>ing anything. What a waste! But... what to yield?</div><div class="css-h14gkn">In redux sagas we communicate with our runner by yielding a set of instructions that <i>describe</i> what we to do. We call these instructions <i>effects</i>. Every one of these effects is a function that will return an object that describes an instruction. Let's see a first example:</div><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Take</h2><div class="css-h14gkn"><code>Take</code> <b>blocks</b> until an action of a given type is dispatched. Then, returns that action.</div><div class="css-h14gkn">We can read it as "hey! I want to wait here until this action is dispatched!"</div><div class="css-h14gkn">Let's write the following code in our root saga to test it:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span></code><code><span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(220, 50, 47);">console</span>.log(<span style="color: rgb(42, 161, 152);">"hi from sagas"</span>);
  <span style="color: rgb(133, 153, 0);">const</span> action = <span style="color: rgb(133, 153, 0);">yield</span> effects.take(constants.TASK_PROCESS);
  <span style="color: rgb(220, 50, 47);">console</span>.log(<span style="color: rgb(42, 161, 152);">"Yay! action received: "</span>, action);
}</code></pre><div class="css-h14gkn">Create a task in the UI and press the button <b>Start</b>. Do you see the log message in the console?</div><div class="css-h14gkn">Try this instruction <code>console.log(effects.take(constants.TASK_PROCESS));</code> to inspect the effect.</div><div class="css-h14gkn">That is, that is <code>take</code>. Let's see its sister <code>put</code>.</div><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Put</h2><div class="css-h14gkn"><code>Put</code> dispatches an action. It is <b>non-blocking</b>: it won't wait indefinitely for something to happen, the execution will continue.</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span></code><code><span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
    <span style="color: rgb(220, 50, 47);">console</span>.log(<span style="color: rgb(42, 161, 152);">"hi from sagas"</span>);
    <span style="color: rgb(133, 153, 0);">const</span> action = <span style="color: rgb(133, 153, 0);">yield</span> effects.take(constants.TASK_PROCESS);
    <span style="color: rgb(220, 50, 47);">console</span>.log(<span style="color: rgb(42, 161, 152);">"Yay! action received: "</span>, action);
    <span style="color: rgb(133, 153, 0);">yield</span> effects.put({ <span style="color: rgb(181, 137, 0);">type</span>: constants.TASK_PROCESS_START, <span style="color: rgb(181, 137, 0);">name</span>: action.name });
    <span style="color: rgb(220, 50, 47);">console</span>.log(<span style="color: rgb(42, 161, 152);">"We just dispatched an action"</span>);
}</code></pre><div class="css-h14gkn">Examine in the console &amp; the redux debugger that we are actually dispatching an action.</div><div class="css-h14gkn">This is a start, but we are just receiving an action and dispatching another, pretty useless still. What about the side effects? Wha about async code? Let's use <code>call</code>. With these three building blocks we can start building very useful things already.</div><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Call</h2><div class="css-h14gkn">Although technically <code>call</code> can do many things, the intuitive idea is very simple: Call <i>something</i>, and <b>block</b> until its execution is finished.</div><div class="css-h14gkn">Let's see an example. Uncomment the function <code>processTaskTimeConsumingReal</code>, which makes an Ajax call and returns a promise:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span></code><code><span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(220, 50, 47);">console</span>.log(<span style="color: rgb(42, 161, 152);">"hi from sagas"</span>);
  <span style="color: rgb(133, 153, 0);">const</span> action = <span style="color: rgb(133, 153, 0);">yield</span> effects.take(constants.TASK_PROCESS);
  <span style="color: rgb(220, 50, 47);">console</span>.log(<span style="color: rgb(42, 161, 152);">"Yay! action received: "</span>, action);
  <span style="color: rgb(133, 153, 0);">yield</span> effects.put({ <span style="color: rgb(181, 137, 0);">type</span>: constants.TASK_PROCESS_START, <span style="color: rgb(181, 137, 0);">name</span>: action.name });
  <span style="color: rgb(220, 50, 47);">console</span>.log(<span style="color: rgb(42, 161, 152);">"We just dispatched an action"</span>);
  <span style="color: rgb(220, 50, 47);">console</span>.log(<span style="color: rgb(42, 161, 152);">"Making a request... this takes time"</span>);
  <span style="color: rgb(133, 153, 0);">yield</span> effects.call(processTaskTimeConsumingReal);
  <span style="color: rgb(220, 50, 47);">console</span>.log(<span style="color: rgb(42, 161, 152);">"Request finished!"</span>);
}</code></pre><div class="css-h14gkn">If we try this piece of code, we will see that <code>call</code> executes the function. This function returns a promise, so call will wait until the promise is fullfilled (or fails), and will give us the value returned, if any.</div><div class="css-h14gkn">We could pass arguments to the function called adding arguments to call: <code>yield effects.call(processTaskTimeConsumingReal, arg1, arg2);</code></div><div class="Block__BlockContainer-sc-1j8mzok-0 hmfkeP"><div class="Block__IconContainer-sc-1j8mzok-1 cIIFuZ"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 eAYolN">Exercise</div>Go ahead and PUT the action <code>{ type: constants.TASK_PROCESS_DONE, name: action.name }</code> after the request has finished. Use it in the browser, it should be able to show a task a completed.<div class="Exercise__Container-gu3dtf-0 fTTJbT"><div class="Exercise__Handler-gu3dtf-1 rqVRq">Reveal the solution</div></div></div><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">The real world is a dangerous place</h2><div class="css-h14gkn">An important part of dealing with the external world (side-effects) is dealing with its imperfections. Things can fail, things can crash, things will crash, so we have to prevent these errors.</div><div class="css-h14gkn">Before we continue, remove or comment out <code>processTaskTimeConsumingReal</code>, uncomment <code>processTaskTimeConsuming</code> and use it instead. This is not a real request, it is a simulation, but will give us more control during this workshop.</div><div class="css-h14gkn"><code>processTaskTimeConsuming</code> is actually... a generator! That is right, <code>call</code> can execute generators as well. And will block until their completion.</div><div class="css-h14gkn">There is a new effect in this generator: <code>delay</code>. It... delays the execution a time in miliseconds. It is very useful in many cases.</div><div class="Block__BlockContainer-sc-1j8mzok-0 hmfkeP"><div class="Block__IconContainer-sc-1j8mzok-1 cIIFuZ"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 eAYolN">Exercise</div>Now, this call will fail 50% of the times. And the error propagates to <code>rootSaga</code>. Can you handle the error in <code>rootSaga</code> so if there is an exception you will gracefully put an action<code>{ type: constants.TASK_PROCESS_ERROR, name: action.name }</code> ?<div class="Exercise__Container-gu3dtf-0 fTTJbT"><div class="Exercise__Handler-gu3dtf-1 rqVRq">Reveal the solution</div></div></div><div class="css-h14gkn">Now this how we can process a request completely with error handling included in redux sagas.</div><div class="css-h14gkn">Still, we can only process one request, and then our generator is finished. Let's fix that.</div><div class="css-h14gkn">But first, let's refactor our code a bit:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span><span class="react-syntax-highlighter-line-number">11
</span><span class="react-syntax-highlighter-line-number">12
</span><span class="react-syntax-highlighter-line-number">13
</span><span class="react-syntax-highlighter-line-number">14
</span></code><code><span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">doProcessTask</span>(<span class="hljs-params">name</span>) </span>{
  <span style="color: rgb(133, 153, 0);">yield</span> effects.put({ <span style="color: rgb(181, 137, 0);">type</span>: constants.TASK_PROCESS_START, name });
  <span style="color: rgb(133, 153, 0);">try</span> {
    <span style="color: rgb(133, 153, 0);">yield</span> effects.call(processTaskTimeConsuming);
    <span style="color: rgb(133, 153, 0);">yield</span> effects.put({ <span style="color: rgb(181, 137, 0);">type</span>: constants.TASK_PROCESS_DONE, name });
  } <span style="color: rgb(133, 153, 0);">catch</span> (error) {
    <span style="color: rgb(133, 153, 0);">yield</span> effects.put({ <span style="color: rgb(181, 137, 0);">type</span>: constants.TASK_PROCESS_ERROR, name });
  }
}

<span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">const</span> action = <span style="color: rgb(133, 153, 0);">yield</span> effects.take(constants.TASK_PROCESS);
  <span style="color: rgb(133, 153, 0);">yield</span> effects.call(doProcessTask, action.name);
}</code></pre><div class="css-h14gkn">Wrap <code>rootSaga</code> in a <code>while(true)</code>:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span></code><code><span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">while</span> (<span style="color: rgb(42, 161, 152);">true</span>) {
    <span style="color: rgb(133, 153, 0);">const</span> action = <span style="color: rgb(133, 153, 0);">yield</span> effects.take(constants.TASK_PROCESS);
    <span style="color: rgb(133, 153, 0);">yield</span> effects.call(doProcessTask, action.name);
  }
}</code></pre><div class="Block__BlockContainer-sc-1j8mzok-0 eqMxxu"><div class="Block__IconContainer-sc-1j8mzok-1 vraSf"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 352 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 tZfGw">Tip</div><div class="css-h14gkn">Backup: <a href="https://gist.github.com/nacmartin/b9853745f463b53cfd31126ed380cd61" class="css-1pjpbx4">this is a gist with the code at this point</a></div></div><div class="css-h14gkn">Ok, now we can, <i>sequentially</i>, process tasks, but one at a time. Why? because <b>call</b> is blocking. This may be what we want in some cases, but most times we would prefer not to block here. We can fix this easily, with a new, powerful, effect.</div><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Fork</h2><div class="css-h14gkn"><code>Fork</code> behaves like <code>call</code> but it is non-blocking. Try replacing <code>call</code> by fork in <code>rootSaga</code>:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span></code><code><span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">while</span> (<span style="color: rgb(42, 161, 152);">true</span>) {
    <span style="color: rgb(133, 153, 0);">const</span> action = <span style="color: rgb(133, 153, 0);">yield</span> effects.take(constants.TASK_PROCESS);
    <span style="color: rgb(133, 153, 0);">yield</span> effects.fork(doProcessTask, action.name);
  }
}</code></pre><div class="css-h14gkn">This pattern is so common, that has his own higher order effect.</div><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">TakeEvery</h2><div class="css-h14gkn"><code>takeEvery(PATTERN, saga, ...args)</code> takes the name of the action (or more complex patterns, see the docs for that) as first argument, and the saga to fork as second</div><div class="css-h14gkn">Try this:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span></code><code><span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">processTask</span>(<span class="hljs-params">action</span>) </span>{
  <span style="color: rgb(133, 153, 0);">yield</span> effects.call(doProcessTask, action.name);
}

<span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">yield</span> effects.takeEvery(constants.TASK_PROCESS, processTask);
}</code></pre><div class="css-h14gkn">We have now, <code>proccessTask</code> and <code>doProcessTask</code> because the first one has the action as argument, and the later the string <code>name</code>.</div><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Cancelling sagas</h2><div class="css-h14gkn">The ability to cancel sagas is a very powerful feature. Let's try this:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span></code><code><span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">while</span> (<span style="color: rgb(42, 161, 152);">true</span>) {
    <span style="color: rgb(133, 153, 0);">const</span> action = <span style="color: rgb(133, 153, 0);">yield</span> effects.take(constants.TASK_PROCESS);
    <span style="color: rgb(133, 153, 0);">const</span> saga = <span style="color: rgb(133, 153, 0);">yield</span> effects.fork(doProcessTask, action.name);
    <span style="color: rgb(133, 153, 0);">yield</span> effects.delay(<span style="color: rgb(42, 161, 152);">500</span>);
    <span style="color: rgb(133, 153, 0);">yield</span> effects.cancel(saga);
  }
}</code></pre><div class="css-h14gkn">This is not very useful, but it is illustrative. <code>cancel</code> cancels another saga, that has been forked, along with its forks, if any.</div><div class="css-h14gkn">Now we are cancelling 500ms after forking, stopping <code>doProcessTask</code>, which leaves us with an infinite spinner.</div><div class="css-h14gkn">We can know in the child saga if it has been cancelled, using <pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span></code><code><span style="color: rgb(133, 153, 0);">try</span>{
    ...
} <span style="color: rgb(133, 153, 0);">finally</span> {
  <span style="color: rgb(133, 153, 0);">if</span> (<span style="color: rgb(133, 153, 0);">yield</span> effects.cancelled()) {
   <span style="color: rgb(147, 161, 161);">// do something useful</span>
  }
}</code></pre></div><div class="Block__BlockContainer-sc-1j8mzok-0 hmfkeP"><div class="Block__IconContainer-sc-1j8mzok-1 cIIFuZ"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 eAYolN">Exercise</div>Can you add a <code>finally</code> clause that puts an action <code>{ type: constants.TASK_PROCESS_RESET, name }</code> in <code>doProcessTask</code> to do some cleanup when the task is cancelled?<div class="Exercise__Container-gu3dtf-0 fTTJbT"><div class="Exercise__Handler-gu3dtf-1 rqVRq">Reveal the solution</div></div></div><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">More higher order sagas: takeLatest, debounce, throttle</h2><div class="css-h14gkn">Let's go back to:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span></code><code><span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">yield</span> effects.takeEvery(constants.TASK_PROCESS, processTask);
}</code></pre><div class="css-h14gkn">As you know this is equivalent to</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span></code><code><span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
<span style="color: rgb(133, 153, 0);">while</span> (<span style="color: rgb(42, 161, 152);">true</span>) {
  <span style="color: rgb(133, 153, 0);">const</span> action = <span style="color: rgb(133, 153, 0);">yield</span> effects.take(constants.TASK_PROCESS);
  <span style="color: rgb(133, 153, 0);">yield</span> effects.fork(doProcessTask, action.name);
}</code></pre><div class="Block__BlockContainer-sc-1j8mzok-0 hmfkeP"><div class="Block__IconContainer-sc-1j8mzok-1 cIIFuZ"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 eAYolN">Exercise</div><div class="css-h14gkn">Instead of <code>takeEvery</code> try <code>takeLeading</code></div><div class="css-h14gkn">Play a bit with it in the UI. We have seen this behaviour in the past, what piece of code was equivalent to this one?</div><div class="Exercise__Container-gu3dtf-0 fTTJbT"><div class="Exercise__Handler-gu3dtf-1 rqVRq">Reveal the solution</div></div></div><div class="Block__BlockContainer-sc-1j8mzok-0 hmfkeP"><div class="Block__IconContainer-sc-1j8mzok-1 cIIFuZ"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 eAYolN">Exercise</div><div class="css-h14gkn">This is more interesting: try instead <code>takeLatest</code></div><div class="css-h14gkn">Play a bit with it in the UI. What does it do? Can you implement it using low level effects?</div><div class="css-h14gkn">Hint: You will need <code>cancel</code>.</div><div class="Exercise__Container-gu3dtf-0 fTTJbT"><div class="Exercise__Handler-gu3dtf-1 rqVRq">Reveal the solution</div></div></div><div class="Block__BlockContainer-sc-1j8mzok-0 hmfkeP"><div class="Block__IconContainer-sc-1j8mzok-1 cIIFuZ"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 eAYolN">Exercise</div><div class="css-h14gkn">If you finished the last one early, can you play with <code>yield effects.throttle(800, constants.TASK_PROCESS, processTask);</code>and try to replicate it?</div><div class="Exercise__Container-gu3dtf-0 fTTJbT"><div class="Exercise__Handler-gu3dtf-1 rqVRq">Reveal the solution</div></div></div><div class="css-h14gkn">There is yet another effect in this family: <code>debounce</code>, but this one is more difficult to express it in terms of low level effects. If you are curious you can have a look to the documentation of redux-saga, in the section API.</div><div class="Block__BlockContainer-sc-1j8mzok-0 eqMxxu"><div class="Block__IconContainer-sc-1j8mzok-1 vraSf"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 352 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 tZfGw">Tip</div><div class="css-h14gkn">Before proceeding to the next section, plase, set the content of this file to <a href="https://gist.github.com/nacmartin/520c8f84cc1031e0f75a1586d599d8b1" class="css-1pjpbx4">this state</a></div></div><h2 class="Heading__PdHeading-sc-1rvjej-0 KWtQC css-a0tgzp">Effect combinators: race and all.</h2><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Race</h2><div class="css-h14gkn"><code>race</code> is very interesting and useful in more cases that you may think of at a first glance.</div><div class="css-h14gkn">Take a look at this code. Try it in our sandbox. What is it doing?</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span></code><code><span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">processTaskTimed</span>(<span class="hljs-params">action</span>) </span>{
  <span style="color: rgb(133, 153, 0);">yield</span> effects.race({
    <span style="color: rgb(181, 137, 0);">response</span>: effects.call(doProcessTask, action.name),
    <span style="color: rgb(181, 137, 0);">timeout</span>: effects.delay(<span style="color: rgb(42, 161, 152);">1500</span>)
  });
}

<span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">yield</span> effects.takeEvery(constants.TASK_PROCESS, processTaskTimed);
}</code></pre><div class="css-h14gkn">This is useful when we can have requests that may not have a response at all. For instance in Bluetooth communication, when we don't know if a package has been lost.</div><div class="Block__BlockContainer-sc-1j8mzok-0 hmfkeP"><div class="Block__IconContainer-sc-1j8mzok-1 cIIFuZ"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 eAYolN">Exercise</div><div class="css-h14gkn">There is a button that says "cancel all tasks!", that had no use... until now. It dispatches an action of type <code>TASK_CANCEL_ALL</code>.</div><div class="css-h14gkn">Can you cancel the processing of a task when this action is dispatched?</div><div class="Exercise__Container-gu3dtf-0 fTTJbT"><div class="Exercise__Handler-gu3dtf-1 rqVRq">Reveal the solution</div></div></div><div class="Block__BlockContainer-sc-1j8mzok-0 hmfkeP"><div class="Block__IconContainer-sc-1j8mzok-1 cIIFuZ"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 eAYolN">Exercise</div><div class="css-h14gkn">Can you cancel the processing of a task when this action is dispatched OR there is a timeout?</div><div class="css-h14gkn">Examine (console.log) what is the return value of <code>yield effects.race({)</code></div>. Can you use it to determine which saga "won" the race and killed the other two?<div class="Exercise__Container-gu3dtf-0 fTTJbT"><div class="Exercise__Handler-gu3dtf-1 rqVRq">Reveal the solution</div></div></div><div class="Block__BlockContainer-sc-1j8mzok-0 eqMxxu"><div class="Block__IconContainer-sc-1j8mzok-1 vraSf"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 352 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 tZfGw">Tip</div><div class="css-h14gkn">Before proceeding to the next section, plase, set the content of this file to <a href="https://gist.github.com/nacmartin/f0ac84e939bf5b4346007666ca017aed" class="css-1pjpbx4">this state</a></div></div><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">All (and select)</h2><div class="css-h14gkn"><code>all</code> is similar in syntax to <code>race</code>, but its purpose is different: it will run all the effects and wait until all are complete (if they all are non blocking like for instance forks it will return immediately).</div><div class="css-h14gkn">We can use it to implement the button "Process all tasks!"</div><div class="css-h14gkn">We would like to retrieve all the tasks that are idle from the state. And start processing them. Can we access the state of redux?</div><div class="css-h14gkn"><code>select</code> does exactly that. Let's see how to call it</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span></code><code><span style="color: rgb(133, 153, 0);">const</span> tasks = <span style="color: rgb(133, 153, 0);">yield</span> effects.select(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span>
  state.tasks.filter(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span> task.state === constants.statuses.IDLE)
);</code></pre><div class="css-h14gkn"><code>select</code> accepts as a parameter a <b>selector</b>. That is, a function that, given the state of redux, will return the data that we want to retrieve.</div><div class="css-h14gkn">We can do for instance this (Because of generators, <code>forEach</code> won't work.) :</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span><span class="react-syntax-highlighter-line-number">11
</span><span class="react-syntax-highlighter-line-number">12
</span><span class="react-syntax-highlighter-line-number">13
</span><span class="react-syntax-highlighter-line-number">14
</span></code><code><span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">processAll</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">const</span> tasks = <span style="color: rgb(133, 153, 0);">yield</span> effects.select(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span>
    state.tasks.filter(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span> task.status === constants.statuses.IDLE)
  );
  <span style="color: rgb(133, 153, 0);">for</span> (<span style="color: rgb(133, 153, 0);">let</span> task <span style="color: rgb(133, 153, 0);">of</span> tasks) {
    <span style="color: rgb(133, 153, 0);">yield</span> effects.fork(doProcessTask, task.name);
  }
}


<span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">yield</span> effects.takeEvery(constants.TASK_PROCESS, processTaskTimed);
  <span style="color: rgb(133, 153, 0);">yield</span> effects.takeEvery(constants.TASK_PROCESS_ALL, processAll);
}</code></pre><div class="css-h14gkn">This runs the tasks sequentially, since they are forks, that are not blocking, they will run simultaneusly.</div><div class="css-h14gkn">But we can use <code>all</code> as well:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span></code><code><span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">processAll</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">const</span> tasks = <span style="color: rgb(133, 153, 0);">yield</span> effects.select(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span>
    state.tasks.filter(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span> task.status === constants.statuses.IDLE)
  );
  <span style="color: rgb(133, 153, 0);">const</span> effectsToRun = tasks.map(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span>
    effects.fork(doProcessTask, task.name)
  );
  <span style="color: rgb(133, 153, 0);">yield</span> effects.all(effectsToRun);
}</code></pre><div class="css-h14gkn">What about cancellation? Can we cancel all these forks at once if we please?</div><div class="css-h14gkn">The easiest thing we can do is to cancel <code>processAll</code> instead. Let's see a pattern that becomes pretty useful:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span><span class="react-syntax-highlighter-line-number">11
</span><span class="react-syntax-highlighter-line-number">12
</span><span class="react-syntax-highlighter-line-number">13
</span><span class="react-syntax-highlighter-line-number">14
</span><span class="react-syntax-highlighter-line-number">15
</span><span class="react-syntax-highlighter-line-number">16
</span><span class="react-syntax-highlighter-line-number">17
</span><span class="react-syntax-highlighter-line-number">18
</span><span class="react-syntax-highlighter-line-number">19
</span><span class="react-syntax-highlighter-line-number">20
</span><span class="react-syntax-highlighter-line-number">21
</span><span class="react-syntax-highlighter-line-number">22
</span><span class="react-syntax-highlighter-line-number">23
</span><span class="react-syntax-highlighter-line-number">24
</span><span class="react-syntax-highlighter-line-number">25
</span><span class="react-syntax-highlighter-line-number">26
</span><span class="react-syntax-highlighter-line-number">27
</span></code><code><span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">processAll</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">const</span> tasks = <span style="color: rgb(133, 153, 0);">yield</span> effects.select(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span>
    state.tasks.filter(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span> task.status === constants.statuses.IDLE)
  );
  <span style="color: rgb(133, 153, 0);">const</span> effectsToRun = tasks.map(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span>
    effects.fork(doProcessTask, task.name)
  );
  <span style="color: rgb(133, 153, 0);">yield</span> effects.all(effectsToRun);
}

<span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">watchCancel</span>(<span class="hljs-params">allProccess</span>) </span>{
  <span style="color: rgb(133, 153, 0);">yield</span> effects.take(constants.TASK_PROCESS_CANCEL_ALL);
  <span style="color: rgb(133, 153, 0);">yield</span> effects.cancel(allProccess);
}

<span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">processAllController</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">while</span> (<span style="color: rgb(42, 161, 152);">true</span>) {
    <span style="color: rgb(133, 153, 0);">yield</span> effects.take(constants.TASK_PROCESS_ALL);
    <span style="color: rgb(133, 153, 0);">const</span> allProcess = <span style="color: rgb(133, 153, 0);">yield</span> effects.fork(processAll);
    <span style="color: rgb(133, 153, 0);">yield</span> effects.fork(watchCancel, allProcess);
  }
}

<span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">yield</span> effects.takeEvery(constants.TASK_PROCESS, processTaskTimed);
  <span style="color: rgb(133, 153, 0);">yield</span> effects.fork(processAllController);
}</code></pre><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Spawn</h2><div class="css-h14gkn">We have a good opportunity now to see see fork's brother, <code>spawn</code>.</div><div class="css-h14gkn"><code>spawn</code> is like <code>fork</code> but <b>detached</b>. That is, cancelling the parent doesn't cancel the spawned saga, and if the spawned saga encounters an error, it won't bubble up to the parent.</div><div class="css-h14gkn">If we replace in <code>processAll</code> the effect <code>fork</code> for <code>spawn</code></div><div class="css-h14gkn">Try this:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span></code><code>
      <span style="color: rgb(133, 153, 0);">const</span> effectsToRun = tasks.map(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span>
        effects.spawn(doProcessTask, task.name)
      );
    </code></pre><div class="css-h14gkn">And see how the cancellation doesn't propagate to the spawned processes.</div><h2 class="Heading__PdHeading-sc-1rvjej-0 KWtQC css-a0tgzp">Channels</h2><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Action channels</h2><div class="Block__BlockContainer-sc-1j8mzok-0 eqMxxu"><div class="Block__IconContainer-sc-1j8mzok-1 vraSf"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 352 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 tZfGw">Tip</div><div class="css-h14gkn">Before continuing, plase, set the content of this file to <a href="https://gist.github.com/nacmartin/51493845c6a7bebaddd3dfb1a74fbaf3" class="css-1pjpbx4">this state</a></div></div><div class="css-h14gkn">ActionChannels act as a buffer, that hold actions so we can <code>take them</code>, even if we are blocking while the action was produced.</div><div class="css-h14gkn">Check this out and see how it resembles to an elevator with memory. While it is processing a task, it is buffering the new actions.</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span></code><code><span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">const</span> requestChan = <span style="color: rgb(133, 153, 0);">yield</span> effects.actionChannel(
    constants.TASK_PROCESS,
  );
  <span style="color: rgb(133, 153, 0);">while</span> (<span style="color: rgb(42, 161, 152);">true</span>) {
    <span style="color: rgb(133, 153, 0);">const</span> action = <span style="color: rgb(133, 153, 0);">yield</span> effects.take(requestChan);
    <span style="color: rgb(133, 153, 0);">yield</span> effects.call(processTask, action);
  }
}</code></pre><div class="css-h14gkn">Check this code out and see how it resembles to an elevator with memory. While it is processing a task, it is buffering the new actions:</div>`<div class="Block__BlockContainer-sc-1j8mzok-0 hmfkeP"><div class="Block__IconContainer-sc-1j8mzok-1 cIIFuZ"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 eAYolN">Exercise</div><div class="css-h14gkn"><code>actionChannel</code> accepts a second argument, the type of buffer. For instance:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span><span class="react-syntax-highlighter-line-number">11
</span><span class="react-syntax-highlighter-line-number">12
</span></code><code><span style="color: rgb(133, 153, 0);">import</span> { buffers } <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"redux-saga"</span>;

<span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">const</span> requestChan = <span style="color: rgb(133, 153, 0);">yield</span> effects.actionChannel(
    constants.TASK_PROCESS,
    buffers.none()
  );
  <span style="color: rgb(133, 153, 0);">while</span> (<span style="color: rgb(42, 161, 152);">true</span>) {
    <span style="color: rgb(133, 153, 0);">const</span> action = <span style="color: rgb(133, 153, 0);">yield</span> effects.take(requestChan);
    <span style="color: rgb(133, 153, 0);">yield</span> effects.call(processTask, action);
  }
}</code></pre><div class="css-h14gkn">Would disable buffering (non taken actions will be lost).</div><div class="css-h14gkn">But... how could you buffer one action, and when a new action comes, it replaces the current buffered action?</div><div class="css-h14gkn">Note: we recommend to increase the time taken to process a task, like so:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span></code><code><span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">processTaskTimeConsuming</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">yield</span> effects.delay(<span style="color: rgb(42, 161, 152);">4000</span> + <span style="color: rgb(42, 161, 152);">1000</span> * <span style="color: rgb(220, 50, 47);">Math</span>.random());
}</code></pre><div class="css-h14gkn">Have a look at <a href="https://redux-saga.js.org/docs/api/#buffers" class="css-1pjpbx4">the documentation of buffers</a></div><div class="Exercise__Container-gu3dtf-0 fTTJbT"><div class="Exercise__Handler-gu3dtf-1 rqVRq">Reveal the solution</div></div></div><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Event channels</h2><div class="css-h14gkn">So far our actions are caused, in a way or another, by the UI (or another saga, that is running because of the UI). The user clicks something, or a React component triggers an action when it mounts, or...</div><div class="css-h14gkn">But sometimes we would like to have other sources of events. We may have a websocket connection. Or we may have a bluetooth connection.</div><div class="css-h14gkn">We would like to be able to emit actions from these sources too.</div><div class="css-h14gkn"><code>eventChannel</code> fulfills this need. It emits Events, and we can <code>take</code> from the channel. Once we take the event, we can put an action, or do whatver we want.</div><div class="css-h14gkn">Run this command to start a node.js server that we have prepared for you. This will start a websocket server that will emit events of type <code>message</code> with this shape every second:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span></code><code>
      {<span style="color: rgb(181, 137, 0);">type</span>: <span style="color: rgb(42, 161, 152);">"create"</span>, <span style="color: rgb(181, 137, 0);">name</span>: <span style="color: rgb(42, 161, 152);">"some_name"</span>}
    </code></pre><div class="Command__PBorder-j2el8m-0 gvcvRb"><div class="css-h14gkn"><code>yarn start-server</code></div></div><div class="css-h14gkn">Now run this code and we can discuss it:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span><span class="react-syntax-highlighter-line-number">11
</span><span class="react-syntax-highlighter-line-number">12
</span><span class="react-syntax-highlighter-line-number">13
</span><span class="react-syntax-highlighter-line-number">14
</span><span class="react-syntax-highlighter-line-number">15
</span><span class="react-syntax-highlighter-line-number">16
</span><span class="react-syntax-highlighter-line-number">17
</span><span class="react-syntax-highlighter-line-number">18
</span><span class="react-syntax-highlighter-line-number">19
</span><span class="react-syntax-highlighter-line-number">20
</span><span class="react-syntax-highlighter-line-number">21
</span><span class="react-syntax-highlighter-line-number">22
</span><span class="react-syntax-highlighter-line-number">23
</span><span class="react-syntax-highlighter-line-number">24
</span><span class="react-syntax-highlighter-line-number">25
</span><span class="react-syntax-highlighter-line-number">26
</span><span class="react-syntax-highlighter-line-number">27
</span><span class="react-syntax-highlighter-line-number">28
</span><span class="react-syntax-highlighter-line-number">29
</span><span class="react-syntax-highlighter-line-number">30
</span><span class="react-syntax-highlighter-line-number">31
</span><span class="react-syntax-highlighter-line-number">32
</span><span class="react-syntax-highlighter-line-number">33
</span><span class="react-syntax-highlighter-line-number">34
</span></code><code><span style="color: rgb(133, 153, 0);">import</span> * <span style="color: rgb(133, 153, 0);">as</span> effects <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"redux-saga/effects"</span>;
<span style="color: rgb(133, 153, 0);">import</span> { END, eventChannel } <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"redux-saga"</span>;
<span style="color: rgb(133, 153, 0);">import</span> * <span style="color: rgb(133, 153, 0);">as</span> constants <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"../actions/constants"</span>;
<span style="color: rgb(133, 153, 0);">import</span> io <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"socket.io-client"</span>;

<span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span> <span style="color: rgb(38, 139, 210);">wsEmitter</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">return</span> eventChannel(<span class="hljs-function"><span class="hljs-params">emitter</span> =&gt;</span> {
    <span style="color: rgb(133, 153, 0);">const</span> socket = io(<span style="color: rgb(42, 161, 152);">"http://localhost:3001"</span>);
    socket.on(<span style="color: rgb(42, 161, 152);">"disconnect"</span>, reason =&gt; {
      emitter(END);
      socket.close();
    });
    socket.on(<span style="color: rgb(42, 161, 152);">"message"</span>, event =&gt; emitter(event));
    <span style="color: rgb(147, 161, 161);">// The subscriber must return an unsubscribe function</span>
    <span style="color: rgb(133, 153, 0);">return</span> <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      socket.close();
    };
  });
}

<span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">wsHandler</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">const</span> wsChan = <span style="color: rgb(133, 153, 0);">yield</span> effects.call(wsEmitter);
  <span style="color: rgb(133, 153, 0);">while</span> (<span style="color: rgb(42, 161, 152);">true</span>) {
    <span style="color: rgb(133, 153, 0);">const</span> event = <span style="color: rgb(133, 153, 0);">yield</span> effects.take(wsChan);
    <span style="color: rgb(133, 153, 0);">if</span> (event.type === <span style="color: rgb(42, 161, 152);">"create"</span>) {
      <span style="color: rgb(133, 153, 0);">yield</span> effects.put({ <span style="color: rgb(181, 137, 0);">type</span>: constants.TASK_CREATE, <span style="color: rgb(181, 137, 0);">name</span>: event.name });
    }
  }
}

<span style="color: rgb(133, 153, 0);">export</span> <span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">rootSaga</span>(<span class="hljs-params"></span>) </span>{
  <span style="color: rgb(133, 153, 0);">yield</span> effects.takeEvery(constants.TASK_PROCESS, processTask);
  <span style="color: rgb(133, 153, 0);">yield</span> effects.fork(wsHandler);
}</code></pre><button class="css-vbif7y"><a class="ButtonLink__StyledLink-sc-1vwfx20-0 fbWjxs" href="http://workshop-sagas.limenius.com/testing">Go to the next section</a></button></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/";window.webpackCompilationHash="27987c61024ed856c501";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-ee930383911b7a727950.js"],"component---src-pages-404-js":["/component---src-pages-404-js-89c1c421f3840ff3dcd5.js"],"component---src-pages-effects-js":["/component---src-pages-effects-js-67bf1d53312ef66d9094.js"],"component---src-pages-index-js":["/component---src-pages-index-js-b322a44ac5e914e16600.js"],"component---src-pages-testing-js":["/component---src-pages-testing-js-30c8d936f19f61056628.js"]};/*]]>*/</script><script src="./effects_files/webpack-runtime-5138ec910dab2fc8c32f.js.descarga" async=""></script><script src="./effects_files/commons-6653d574c9f9e480a8c9.js.descarga" async=""></script><script src="./effects_files/component---src-pages-index-js-b322a44ac5e914e16600.js.descarga" async=""></script><script src="./effects_files/app-ee930383911b7a727950.js.descarga" async=""></script></body></html>