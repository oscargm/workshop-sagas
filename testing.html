<!DOCTYPE html>
<!-- saved from url=(0042)http://workshop-sagas.limenius.com/testing -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Gatsby 2.15.18"><title data-react-helmet="true"></title><link rel="manifest" href="http://workshop-sagas.limenius.com/manifest.webmanifest"><meta name="theme-color" content="#663399"><link rel="apple-touch-icon" sizes="48x48" href="http://workshop-sagas.limenius.com/icons/icon-48x48.png"><link rel="apple-touch-icon" sizes="72x72" href="http://workshop-sagas.limenius.com/icons/icon-72x72.png"><link rel="apple-touch-icon" sizes="96x96" href="http://workshop-sagas.limenius.com/icons/icon-96x96.png"><link rel="apple-touch-icon" sizes="144x144" href="http://workshop-sagas.limenius.com/icons/icon-144x144.png"><link rel="apple-touch-icon" sizes="192x192" href="http://workshop-sagas.limenius.com/icons/icon-192x192.png"><link rel="apple-touch-icon" sizes="256x256" href="http://workshop-sagas.limenius.com/icons/icon-256x256.png"><link rel="apple-touch-icon" sizes="384x384" href="http://workshop-sagas.limenius.com/icons/icon-384x384.png"><link rel="apple-touch-icon" sizes="512x512" href="http://workshop-sagas.limenius.com/icons/icon-512x512.png"><link as="script" rel="preload" href="./testing_files/app-ee930383911b7a727950.js.descarga"><link as="script" rel="preload" href="./testing_files/component---src-pages-index-js-b322a44ac5e914e16600.js.descarga"><link as="script" rel="preload" href="./testing_files/commons-6653d574c9f9e480a8c9.js.descarga"><link as="script" rel="preload" href="./testing_files/webpack-runtime-5138ec910dab2fc8c32f.js.descarga"><link as="fetch" rel="preload" href="http://workshop-sagas.limenius.com/page-data/index/page-data.json" crossorigin="anonymous"><style data-emotion-css="hz92mv">.css-hz92mv{box-sizing:border-box;margin:0;min-width:0;font-size:24px;font-family:system-ui,sans-serif;font-weight:700;line-height:1.25;font-size:64px;}</style><style data-emotion-css="oio2uc">.css-oio2uc{box-sizing:border-box;margin:0;min-width:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:inline-block;text-align:center;line-height:inherit;-webkit-text-decoration:none;text-decoration:none;font-size:inherit;padding-left:16px;padding-right:16px;padding-top:8px;padding-bottom:8px;color:white;background-color:var(--theme-ui-colors-primary,#07c);border:0;border-radius:4px;font-size:16px;font-weight:700;color:var(--theme-ui-colors-background,#fff);background-color:var(--theme-ui-colors-primary,#07c);border-radius:4px;margin-right:4px;}</style><style data-emotion-css="vbif7y">.css-vbif7y{box-sizing:border-box;margin:0;min-width:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:inline-block;text-align:center;line-height:inherit;-webkit-text-decoration:none;text-decoration:none;font-size:inherit;padding-left:16px;padding-right:16px;padding-top:8px;padding-bottom:8px;color:white;background-color:var(--theme-ui-colors-primary,#07c);border:0;border-radius:4px;font-size:16px;font-weight:700;color:var(--theme-ui-colors-primary,#07c);background-color:transparent;border-radius:4px;box-shadow:inset 0 0 2px;margin-right:4px;}</style><style data-emotion-css="vbif7y">.css-vbif7y{box-sizing:border-box;margin:0;min-width:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:inline-block;text-align:center;line-height:inherit;-webkit-text-decoration:none;text-decoration:none;font-size:inherit;padding-left:16px;padding-right:16px;padding-top:8px;padding-bottom:8px;color:white;background-color:var(--theme-ui-colors-primary,#07c);border:0;border-radius:4px;font-size:16px;font-weight:700;color:var(--theme-ui-colors-primary,#07c);background-color:transparent;border-radius:4px;box-shadow:inset 0 0 2px;margin-right:4px;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="1s6s98">.css-1s6s98{box-sizing:border-box;margin:0;min-width:0;font-size:24px;font-family:system-ui,sans-serif;font-weight:700;line-height:1.25;font-size:32px;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="162xvp5">.css-162xvp5{box-sizing:border-box;margin:0;min-width:0;font-size:24px;font-family:system-ui,sans-serif;font-weight:700;line-height:1.25;font-size:20px;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="162xvp5">.css-162xvp5{box-sizing:border-box;margin:0;min-width:0;font-size:24px;font-family:system-ui,sans-serif;font-weight:700;line-height:1.25;font-size:20px;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="162xvp5">.css-162xvp5{box-sizing:border-box;margin:0;min-width:0;font-size:24px;font-family:system-ui,sans-serif;font-weight:700;line-height:1.25;font-size:20px;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="162xvp5">.css-162xvp5{box-sizing:border-box;margin:0;min-width:0;font-size:24px;font-family:system-ui,sans-serif;font-weight:700;line-height:1.25;font-size:20px;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="h14gkn">.css-h14gkn{box-sizing:border-box;margin:0;min-width:0;padding:0.5em;}</style><style data-emotion-css="1pjpbx4">.css-1pjpbx4{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="vbif7y">.css-vbif7y{box-sizing:border-box;margin:0;min-width:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:inline-block;text-align:center;line-height:inherit;-webkit-text-decoration:none;text-decoration:none;font-size:inherit;padding-left:16px;padding-right:16px;padding-top:8px;padding-bottom:8px;color:white;background-color:var(--theme-ui-colors-primary,#07c);border:0;border-radius:4px;font-size:16px;font-weight:700;color:var(--theme-ui-colors-primary,#07c);background-color:transparent;border-radius:4px;box-shadow:inset 0 0 2px;margin-right:4px;}</style><style data-styled="" data-styled-version="4.3.2"></style><link rel="prefetch" href="http://workshop-sagas.limenius.com/page-data/effects/page-data.json"><link rel="prefetch" href="http://workshop-sagas.limenius.com/page-data/testing/page-data.json"><link rel="prefetch" href="./testing_files/component---src-pages-effects-js-67bf1d53312ef66d9094.js.descarga"><link rel="prefetch" href="./testing_files/component---src-pages-testing-js-30c8d936f19f61056628.js.descarga"><script charset="utf-8" src="./testing_files/component---src-pages-effects-js-67bf1d53312ef66d9094.js.descarga"></script><script charset="utf-8" src="./testing_files/component---src-pages-testing-js-30c8d936f19f61056628.js.descarga"></script><style data-emotion="css"></style></head><body class=""><script>(function() { try {
        var mode = localStorage.getItem('theme-ui-color-mode');
        if (!mode) return
        document.body.classList.add('theme-ui-' + mode);
      } catch (e) {} })();</script><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div><div><h2 class="Heading__PdHeading-sc-1rvjej-0 jhtTmC css-hz92mv">Sagas Workshop</h2><button class="css-vbif7y"><a class="ButtonLink__StyledLink-sc-1vwfx20-0 fbWjxs" href="http://workshop-sagas.limenius.com/">Generators</a></button><button class="css-vbif7y"><a class="ButtonLink__StyledLink-sc-1vwfx20-0 fbWjxs" href="http://workshop-sagas.limenius.com/effects">Effects</a></button><button class="css-oio2uc"><a aria-current="page" class="Toc__StyledLinkActive-qwmjyy-0 kDDVDJ" href="http://workshop-sagas.limenius.com/testing">Testing</a></button></div><h2 class="Heading__PdHeading-sc-1rvjej-0 iWbnHQ css-1s6s98">Testing sagas</h2><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Context</h2><div class="Block__BlockContainer-sc-1j8mzok-0 eqMxxu"><div class="Block__IconContainer-sc-1j8mzok-1 vraSf"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 352 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 tZfGw">Tip</div><div class="css-h14gkn">Before we continue, set the contents of <code>rootSaga</code> to <a href="https://gist.github.com/nacmartin/57a7584d4681ebf100c819416fa66400" class="css-1pjpbx4">this gist.</a></div></div><div class="css-h14gkn">First of all, there is a small problem with that <code>const socket = yield call(io,"http://localhost:3001");</code>.</div><div class="css-h14gkn">There are dependencies, like <code>io</code>, that are going to be difficult to handle during testing. We could use a mock, but we can avoid that as well using context and make our sagas less dependant of the external world.</div><div class="css-h14gkn">Check this out. When we create our sagas in <code>makeStore.js</code> we can provide a context:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span></code><code><span style="color: rgb(133, 153, 0);">import</span> io <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"socket.io-client"</span>;
      
      <span style="color: rgb(147, 161, 161);">//...</span>

      <span style="color: rgb(133, 153, 0);">const</span> sagaMiddleware = createSagaMiddleware({ <span style="color: rgb(181, 137, 0);">context</span>: { io } });</code></pre><div class="css-h14gkn">And then we can do in our <code>rootSaga.js</code>:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span><span class="react-syntax-highlighter-line-number">11
</span><span class="react-syntax-highlighter-line-number">12
</span><span class="react-syntax-highlighter-line-number">13
</span><span class="react-syntax-highlighter-line-number">14
</span><span class="react-syntax-highlighter-line-number">15
</span></code><code><span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>* <span style="color: rgb(38, 139, 210);">wsEmitter</span>(<span class="hljs-params"></span>) </span>{
      <span style="color: rgb(133, 153, 0);">const</span> io = <span style="color: rgb(133, 153, 0);">yield</span> effects.getContext(<span style="color: rgb(42, 161, 152);">"io"</span>);
      <span style="color: rgb(133, 153, 0);">return</span> eventChannel(<span class="hljs-function"><span style="color: rgb(133, 153, 0);">function</span>(<span class="hljs-params">emitter</span>) </span>{
        <span style="color: rgb(133, 153, 0);">const</span> socket = io(<span style="color: rgb(42, 161, 152);">"http://localhost:3001"</span>);
        socket.on(<span style="color: rgb(42, 161, 152);">"disconnect"</span>, reason =&gt; {
          emitter(END);
          socket.close();
        });
        socket.on(<span style="color: rgb(42, 161, 152);">"message"</span>, event =&gt; emitter(event));
        <span style="color: rgb(147, 161, 161);">// The subscriber must return an unsubscribe function</span>
        <span style="color: rgb(133, 153, 0);">return</span> <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
          socket.close();
        };
      });
    }</code></pre><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Testing with generators</h2><div class="css-h14gkn">Since redux saga's effects are declarative, we can easily test sagas without much hassle. For instance, copy this code into <code>src/sagas/rootSaga.test.js</code> and run:</div><div class="Command__PBorder-j2el8m-0 gvcvRb"><div class="css-h14gkn"><code>yarn test</code></div></div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span><span class="react-syntax-highlighter-line-number">11
</span><span class="react-syntax-highlighter-line-number">12
</span></code><code>
<span style="color: rgb(133, 153, 0);">import</span> { rootSaga } <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"./rootSaga"</span>;
<span style="color: rgb(133, 153, 0);">import</span> * <span style="color: rgb(133, 153, 0);">as</span> effects <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"redux-saga/effects"</span>;
<span style="color: rgb(133, 153, 0);">import</span> * <span style="color: rgb(133, 153, 0);">as</span> constants <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"../actions/constants"</span>;
<span style="color: rgb(133, 153, 0);">import</span> { processTask } <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"./rootSaga"</span>;

test(<span style="color: rgb(42, 161, 152);">"it should fork processTask and wsHandler"</span>, () =&gt; {
  <span style="color: rgb(133, 153, 0);">const</span> it = rootSaga();
  expect(it.next().value).toEqual(
    effects.takeEvery(constants.TASK_PROCESS, processTask)
  );
});</code></pre><div class="css-h14gkn">As you see, knowing how generators work is pretty handy.</div><div class="Block__BlockContainer-sc-1j8mzok-0 hmfkeP"><div class="Block__IconContainer-sc-1j8mzok-1 cIIFuZ"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 eAYolN">Exercise</div><div class="css-h14gkn">Can you test the next effect as well (<code>fork(wsHandler)</code>)?</div><div class="css-h14gkn">Can you test as well that the saga is done after that?</div><div class="Exercise__Container-gu3dtf-0 fTTJbT"><div class="Exercise__Handler-gu3dtf-1 rqVRq">Reveal the solution</div></div></div><h2 class="Heading__PdHeading-sc-1rvjej-0 cAgqwr css-162xvp5">Testing with redux-saga-test-plan</h2><div class="css-h14gkn">Testing with generators is useful, but it becomes easily a repetition of the code.</div><div class="css-h14gkn">With redux-saga-test-plan we can test the <i>intention</i> of the code.</div><div class="css-h14gkn">For instance, we can assert that when we dispatch <code>TASK_PROCESS</code> we will put <code>TASK_PROCESS_START</code>.</div><div class="css-h14gkn">Examine and run this code:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span><span class="react-syntax-highlighter-line-number">11
</span><span class="react-syntax-highlighter-line-number">12
</span><span class="react-syntax-highlighter-line-number">13
</span><span class="react-syntax-highlighter-line-number">14
</span><span class="react-syntax-highlighter-line-number">15
</span><span class="react-syntax-highlighter-line-number">16
</span><span class="react-syntax-highlighter-line-number">17
</span><span class="react-syntax-highlighter-line-number">18
</span><span class="react-syntax-highlighter-line-number">19
</span><span class="react-syntax-highlighter-line-number">20
</span><span class="react-syntax-highlighter-line-number">21
</span><span class="react-syntax-highlighter-line-number">22
</span></code><code><span style="color: rgb(133, 153, 0);">import</span> { expectSaga } <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"redux-saga-test-plan"</span>;
<span style="color: rgb(133, 153, 0);">import</span> * <span style="color: rgb(133, 153, 0);">as</span> effects <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"redux-saga/effects"</span>;
<span style="color: rgb(133, 153, 0);">import</span> { throwError } <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">'redux-saga-test-plan/providers'</span>;

<span style="color: rgb(133, 153, 0);">import</span> * <span style="color: rgb(133, 153, 0);">as</span> constants <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"../actions/constants"</span>;
<span style="color: rgb(133, 153, 0);">import</span> { processTask, rootSaga, wsHandler, processTaskTimeConsuming } <span style="color: rgb(133, 153, 0);">from</span> <span style="color: rgb(42, 161, 152);">"./rootSaga"</span>;

<span style="color: rgb(147, 161, 161);">//...</span>

test(<span style="color: rgb(42, 161, 152);">"handles TASK_PROCESS!"</span>, () =&gt; {
  <span style="color: rgb(133, 153, 0);">return</span> expectSaga(rootSaga)
    .put({
      <span style="color: rgb(181, 137, 0);">type</span>: constants.TASK_PROCESS_START,
      <span style="color: rgb(181, 137, 0);">name</span>: <span style="color: rgb(42, 161, 152);">"a name"</span>
    })

    .dispatch({
      <span style="color: rgb(181, 137, 0);">type</span>: constants.TASK_PROCESS,
      <span style="color: rgb(181, 137, 0);">name</span>: <span style="color: rgb(42, 161, 152);">"a name"</span>
    })
    .run();
});</code></pre><div class="css-h14gkn">We can also mock effects with providers:</div><pre class="CustomPre-sc-1vx1do9-0 kZuqDR" style="display: block; overflow-x: auto; padding: 0.5em; background: rgb(253, 246, 227); color: rgb(101, 123, 131);"><code style="float: left; padding-right: 10px;"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span><span class="react-syntax-highlighter-line-number">11
</span><span class="react-syntax-highlighter-line-number">12
</span><span class="react-syntax-highlighter-line-number">13
</span><span class="react-syntax-highlighter-line-number">14
</span></code><code>test(<span style="color: rgb(42, 161, 152);">"handles TASK_PROCESS!"</span>, () =&gt; {
  <span style="color: rgb(133, 153, 0);">return</span> expectSaga(rootSaga)
    .provide([[effects.call(processTaskTimeConsuming), <span style="color: rgb(42, 161, 152);">"mock return value"</span>]])
    .put({
      <span style="color: rgb(181, 137, 0);">type</span>: constants.TASK_PROCESS_START,
      <span style="color: rgb(181, 137, 0);">name</span>: <span style="color: rgb(42, 161, 152);">"a name"</span>
    })

    .dispatch({
      <span style="color: rgb(181, 137, 0);">type</span>: constants.TASK_PROCESS,
      <span style="color: rgb(181, 137, 0);">name</span>: <span style="color: rgb(42, 161, 152);">"a name"</span>
    })
    .run();
});</code></pre><div class="css-h14gkn">With providers we can avoid doing API calls or doing the actual calls.</div><div class="css-h14gkn">We can use also a provider to simulate an error:</div><div class="Block__BlockContainer-sc-1j8mzok-0 hmfkeP"><div class="Block__IconContainer-sc-1j8mzok-1 cIIFuZ"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 eAYolN">Exercise</div><div class="css-h14gkn">With this in mind can you test this flow?</div><div class="css-h14gkn">When I dispatch <code>TASK_PROCESS</code>, and there is no error in <code>processTaskConsuming</code>, the saga will put an action of type <code>TASK_PROCESS_START</code> and an action of type <code>TASK_PROCESS_DONE</code>.</div><div class="Exercise__Container-gu3dtf-0 fTTJbT"><div class="Exercise__Handler-gu3dtf-1 rqVRq">Reveal the solution</div></div></div><div class="Block__BlockContainer-sc-1j8mzok-0 hmfkeP"><div class="Block__IconContainer-sc-1j8mzok-1 cIIFuZ"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"></path></svg></div><div class="Block__BlockHeader-sc-1j8mzok-2 eAYolN">Exercise</div><div class="css-h14gkn">And this flow?</div><div class="css-h14gkn">When I dispatch <code>TASK_PROCESS</code>, and there is an error in <code>processTaskConsuming</code>, the saga will put an action of type <code>TASK_PROCESS_START</code> and an action of type <code>TASK_PROCESS_ERROR</code>.</div><div class="Exercise__Container-gu3dtf-0 fTTJbT"><div class="Exercise__Handler-gu3dtf-1 rqVRq">Reveal the solution</div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/";window.webpackCompilationHash="27987c61024ed856c501";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-ee930383911b7a727950.js"],"component---src-pages-404-js":["/component---src-pages-404-js-89c1c421f3840ff3dcd5.js"],"component---src-pages-effects-js":["/component---src-pages-effects-js-67bf1d53312ef66d9094.js"],"component---src-pages-index-js":["/component---src-pages-index-js-b322a44ac5e914e16600.js"],"component---src-pages-testing-js":["/component---src-pages-testing-js-30c8d936f19f61056628.js"]};/*]]>*/</script><script src="./testing_files/webpack-runtime-5138ec910dab2fc8c32f.js.descarga" async=""></script><script src="./testing_files/commons-6653d574c9f9e480a8c9.js.descarga" async=""></script><script src="./testing_files/component---src-pages-index-js-b322a44ac5e914e16600.js.descarga" async=""></script><script src="./testing_files/app-ee930383911b7a727950.js.descarga" async=""></script></body></html>